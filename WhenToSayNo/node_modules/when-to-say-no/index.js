/* nahee.app/node-modules/when-to-say-no/index.js */

var axios = require('axios');
var ip = require('ip');

var myIP = ip.address();

var coeffsForWllngnssForReq = [];
var coeffId;

var whenToSayNo = module.exports;

whenToSayNo.setup = function() {
	axios.get(myIP + "/api/mind/coefficient", params: {
	    name: 'willingnessForReq'
	  })
	  .then(function (response) {
	    coeffsForWllngnssForReq = JSON.parse(response.data.coeffs_arr);
	    coeffId = JSON.parse(response.data.coeff_id);
	  })
	  .catch(function (error) {
	    console.log(error);
	  })
}

whenToSayNo.wllngnssCalibrationForSelf = function() {
	return function (req, res, next) {
		var coeffForDesire = coeffsForWllngnssForReq[0];
		var coeffForBdyCondition = coeffsForWllngnssForReq[1];
		var coeffForAnxiety = coeffsForWllngnssForReq[2];

		coeffForDesire = coeffForDesire * 1.3;
		coeffForBdyCondition = coeffForBdyCondition * 2;
		coeffForAnxiety = coeffForAnxiety * 0.01;

		axios.put(myIP + '/api/mind/coefficient/' + coeffId, {
		    name: 'willingnessForReq',
		    coeffsArr: [coeffForDesire, coeffForBdyCondition, coeffForAnxiety];
		  })
		  .then(function (response) {
		    console.log(response);
		  })
		  .catch(function (error) {
		    console.log(error);
		  });

		next()
	}

}